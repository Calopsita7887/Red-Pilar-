<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteo Red Pilar</title>
    <style>
        /* --- ESTILOS GENERALES (TEMA PREDETERMINADO) --- */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
            transition: background-color 0.5s ease, color 0.5s ease;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            transition: background-color 0.5s ease, box-shadow 0.5s ease, border 0.5s ease;
        }
        .logo-container {
            text-align: center;
            margin-bottom: 20px;
        }
        .logo {
            width: 100px;
            height: auto;
        }
        h1 {
            color: #4CAF50;
            text-align: center;
            transition: color 0.5s ease;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            transition: color 0.5s ease;
        }
        input[type="text"] {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.5s ease, background-color 0.5s ease, color 0.5s ease;
        }
        #numbers-container {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            max-height: 250px;
            overflow-y: auto;
            transition: border-color 0.5s ease, background-color 0.5s ease;
        }
        .number-box {
            background-color: #e9e9e9;
            text-align: center;
            padding: 8px 0;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s, color 0.2s, border 0.2s ease;
            font-size: 14px;
            font-weight: bold;
        }
        .number-box:hover {
            background-color: #ddd;
        }
        .number-box.selected {
            background-color: #4CAF50;
            color: #fff;
            transform: scale(1.05);
        }
        .number-box.assigned {
            background-color: #ccc;
            text-decoration: line-through;
            color: #777;
            cursor: not-allowed;
        }
        .button-group, .add-numbers-group, #theme-toggle-group, .range-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .add-numbers-group, .range-buttons {
            margin-top: 10px;
        }
        .range-buttons button {
            flex-grow: 1;
            margin-right: 5px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
            flex-grow: 1;
            margin: 0 5px;
        }
        button:first-child { margin-left: 0; }
        button:last-child { margin-right: 0; }
        #add-button { background-color: #4CAF50; }
        #add-button:hover { background-color: #45a049; }
        #clear-button { background-color: #f44336; }
        #clear-button:hover { background-color: #da190b; }
        #sorteo-button { background-color: #007BFF; }
        #sorteo-button:hover { background-color: #0056b3; }
        .add-numbers-group button, .range-buttons button { background-color: #17a2b8; }
        .add-numbers-group button:hover, .range-buttons button:hover { background-color: #138496; }
        #results-container, #history-container {
            margin-top: 30px;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            border: 1px solid #eee;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
            transition: background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease;
        }
        .person-entry, .history-entry {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: border-color 0.5s ease;
        }
        .person-entry:last-child, .history-entry:last-child {
            border-bottom: none;
        }
        .person-info {
            flex-grow: 1;
        }
        .person-name {
            font-weight: bold;
            color: #007BFF;
            margin-bottom: 5px;
            transition: color 0.5s ease;
        }
        .person-numbers {
            font-size: 14px;
        }
        .person-actions {
            margin-left: 10px;
        }
        .action-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            margin-left: 5px;
            color: #777;
            transition: color 0.2s;
        }
        .action-button:hover {
            color: #000;
        }
        .edit-mode .person-info, .edit-mode .person-actions {
            flex-direction: column;
            align-items: flex-start;
        }
        .edit-mode .person-info {
            width: 100%;
        }
        .edit-mode .person-name {
            margin-bottom: 10px;
        }
        .edit-mode .person-actions {
            margin-top: 10px;
            display: flex;
            justify-content: flex-end;
            width: 100%;
        }
        .edit-mode .person-actions button {
            margin-left: 10px;
        }
        .edit-mode .person-numbers-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }
        .edit-mode .person-number-chip {
            background-color: #e9e9e9;
            padding: 5px 8px;
            border-radius: 12px;
            display: flex;
            align-items: center;
        }
        .edit-mode .person-number-chip button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            color: #f44336;
            margin-left: 5px;
            padding: 0;
        }
        .edit-mode .person-number-chip button:hover {
            color: #da190b;
        }
        /* ESTILOS DEL BOT√ìN ACTUALIZADO EN MODO EDICI√ìN */
        .edit-mode #add-number-btn { background-color: #007BFF; }
        .edit-mode #add-number-btn:hover { background-color: #0056b3; }
        .edit-mode #update-name-btn { background-color: #4CAF50; color: #fff; }
        .edit-mode #update-name-btn:hover { background-color: #45a049; }
        #ganador-container {
            margin-top: 20px;
            text-align: center;
            position: relative;
        }
        #ganador-container h2 {
            color: #ffc107;
            transition: color 0.5s ease;
        }
        #ganador-nombre, #ganador-numero {
            font-size: 2em;
            font-weight: bold;
            color: #007BFF;
            transition: transform 0.5s ease-in-out, color 0.5s ease;
            min-height: 1.5em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #ganador-numero {
            color: #4CAF50;
            margin-bottom: 10px;
            transition: color 0.5s ease;
        }
        .sorteo-running {
            animation: spin 0.025s linear infinite;
        }
        .ganador-zoom {
            animation: winnerZoom 1s ease-in-out;
        }
        @keyframes winnerZoom {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }
        #countdown-timer {
            font-size: 3em;
            font-weight: bold;
            color: #f44336;
            margin-top: 20px;
            transition: color 0.5s ease;
        }
        .confetti {
            width: 10px;
            height: 10px;
            background-color: #f06;
            position: absolute;
            top: -10px;
            border-radius: 50%;
            z-index: 1;
        }
        @keyframes fall {
            to {
                top: 105%;
                transform: translate(-50%, 0) rotateZ(360deg);
                opacity: 0;
            }
        }
        
        /* --- ESTILOS TEMA COSMIC --- */
        body.cosmic-theme {
            background: #00001a;
            color: #e0e0ff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container.cosmic-theme {
            background-color: #1a0033;
            box-shadow: 0 0 20px rgba(70, 0, 100, 0.8), inset 0 0 10px rgba(100, 0, 150, 0.5);
            border: 2px solid #5d00a0;
        }
        .cosmic-theme h1 {
            color: #d495ff;
            text-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff;
        }
        .cosmic-theme label {
            color: #b3a0d3;
        }
        .cosmic-theme input[type="text"] {
            background-color: #220044;
            color: #a0d4ff;
            border-color: #4b0082;
            box-shadow: inset 0 0 5px rgba(160, 212, 255, 0.5);
        }
        .cosmic-theme #numbers-container {
            background-color: #220044;
            border-color: #4b0082;
            box-shadow: inset 0 0 10px rgba(160, 212, 255, 0.3);
        }
        .cosmic-theme .number-box {
            background-color: #330066;
            color: #e0e0ff;
            border: 1px solid #5d00a0;
        }
        .cosmic-theme .number-box:hover {
            background-color: #5d00a0;
            color: #fff;
            box-shadow: 0 0 5px #d495ff;
        }
        .cosmic-theme .number-box.selected {
            background-color: #8a2be2;
            color: #fff;
            box-shadow: 0 0 10px #ff00ff;
        }
        .cosmic-theme .number-box.assigned {
            background-color: #330044;
            color: #663399;
            text-decoration-color: #9966cc;
        }
        .cosmic-theme #add-button { background-color: #483d8b; }
        .cosmic-theme #add-button:hover { background-color: #6a5acd; }
        .cosmic-theme #sorteo-button { background-color: #d495ff; color: #000; }
        .cosmic-theme #sorteo-button:hover { background-color: #b56eff; }
        .cosmic-theme #clear-button { background-color: #e30022; }
        .cosmic-theme #clear-button:hover { background-color: #a30019; }
        .cosmic-theme .add-numbers-group button, .cosmic-theme .range-buttons button { background-color: #00aaff; }
        .cosmic-theme .add-numbers-group button:hover, .cosmic-theme .range-buttons button:hover { background-color: #0077cc; }
        .cosmic-theme #results-container, .cosmic-theme #history-container {
            background-color: #220044;
            border-color: #4b0082;
            box-shadow: inset 0 0 10px rgba(160, 212, 255, 0.3);
        }
        .cosmic-theme .person-entry, .cosmic-theme .history-entry {
            border-bottom: 1px solid #5d00a0;
        }
        .cosmic-theme .person-name {
            color: #a0d4ff;
        }
        .cosmic-theme .action-button {
            color: #b3a0d3;
        }
        .cosmic-theme .action-button:hover {
            color: #fff;
        }
        .cosmic-theme .edit-mode input[type="text"] {
            background-color: #330066;
            color: #a0d4ff;
            border-color: #5d00a0;
        }
        .cosmic-theme .edit-mode .person-number-chip {
            background-color: #5d00a0;
            color: #e0e0ff;
        }
        .cosmic-theme .edit-mode .person-number-chip button {
            color: #d495ff;
        }
        .cosmic-theme .edit-mode #add-number-btn { background-color: #00aaff; color: #fff; }
        .cosmic-theme .edit-mode #add-number-btn:hover { background-color: #0077cc; }
        .cosmic-theme .edit-mode #update-name-btn { background-color: #483d8b; color: #fff; }
        .cosmic-theme .edit-mode #update-name-btn:hover { background-color: #6a5acd; }
        .cosmic-theme #ganador-container h2 {
            color: #d495ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        .cosmic-theme #ganador-nombre {
            color: #a0d4ff;
            text-shadow: 0 0 10px #a0d4ff;
        }
        .cosmic-theme #ganador-numero {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        .cosmic-theme #countdown-timer {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        /* --- ESTILOS TEMA NEON PARTY --- */
        body.neon-theme {
            background-color: #0a0a1a;
            color: #f0f0f0;
            font-family: 'Consolas', 'Courier New', monospace;
        }
        .container.neon-theme {
            background-color: #1a1a2a;
            box-shadow: 0 0 20px 5px rgba(100, 255, 255, 0.4);
            border: 1px solid #64ffda;
        }
        .neon-theme h1 {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff;
            font-family: 'Consolas', 'Courier New', monospace;
        }
        .neon-theme label {
            color: #f0f0f0;
        }
        .neon-theme input[type="text"] {
            background-color: #333344;
            color: #64ffda;
            border: 1px solid #64ffda;
            box-shadow: 0 0 5px #64ffda;
        }
        .neon-theme #numbers-container {
            background-color: #1a1a2a;
            border: 1px solid #64ffda;
            box-shadow: inset 0 0 5px #64ffda;
        }
        .neon-theme .number-box {
            background-color: #333344;
            color: #64ffda;
            border: 1px solid #64ffda;
        }
        .neon-theme .number-box:hover {
            background-color: #ff00ff;
            color: #000;
            box-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff;
        }
        .neon-theme .number-box.selected {
            background-color: #00ffff;
            color: #000;
            box-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff;
        }
        .neon-theme .number-box.assigned {
            background-color: #222233;
            color: #555566;
            text-decoration-color: #555566;
        }
        .neon-theme #add-button { background-color: #00aaff; }
        .neon-theme #add-button:hover { background-color: #0077cc; }
        .neon-theme #sorteo-button { background-color: #ff00ff; }
        .neon-theme #sorteo-button:hover { background-color: #cc00cc; }
        .neon-theme #clear-button { background-color: #e04040; }
        .neon-theme #clear-button:hover { background-color: #a02020; }
        .neon-theme .add-numbers-group button, .neon-theme .range-buttons button { background-color: #64ffda; color: #000; }
        .neon-theme .add-numbers-group button:hover, .neon-theme .range-buttons button:hover { background-color: #00e6b8; }
        .neon-theme #results-container, .neon-theme #history-container {
            background-color: #1a1a2a;
            border: 1px solid #64ffda;
            box-shadow: inset 0 0 5px #64ffda;
        }
        .neon-theme .person-entry, .neon-theme .history-entry {
            border-bottom: 1px solid #64ffda;
        }
        .neon-theme .person-name {
            color: #ff00ff;
        }
        .neon-theme .action-button {
            color: #64ffda;
        }
        .neon-theme .action-button:hover {
            color: #00ffff;
        }
        .neon-theme .edit-mode input[type="text"] {
            background-color: #333344;
            color: #64ffda;
            border-color: #64ffda;
        }
        .neon-theme .edit-mode .person-number-chip {
            background-color: #64ffda;
            color: #000;
        }
        .neon-theme .edit-mode .person-number-chip button {
            color: #ff00ff;
        }
        .neon-theme .edit-mode #add-number-btn { background-color: #00ffff; color: #000; }
        .neon-theme .edit-mode #add-number-btn:hover { background-color: #00cccc; }
        .neon-theme .edit-mode #update-name-btn { background-color: #ff00ff; color: #000; }
        .neon-theme .edit-mode #update-name-btn:hover { background-color: #cc00cc; }
        .neon-theme #ganador-container h2 {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        .neon-theme #ganador-nombre {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        .neon-theme #ganador-numero {
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
        }
        .neon-theme #countdown-timer {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        
        /* --- ESTILOS TEMA PASTEL DREAMS --- */
        body.pastel-theme {
            background-color: #f7e1e6;
            color: #5e548e;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        .container.pastel-theme {
            background-color: #fff0f3;
            box-shadow: 0 4px 15px rgba(181, 126, 220, 0.4);
            border: 2px solid #b57edc;
        }
        .pastel-theme h1 {
            color: #ff66a4;
            text-shadow: 1px 1px 5px rgba(255, 102, 164, 0.5);
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        .pastel-theme label {
            color: #9381ff;
        }
        .pastel-theme input[type="text"] {
            background-color: #fff8f8;
            color: #5e548e;
            border: 1px solid #b57edc;
            box-shadow: inset 0 0 5px rgba(181, 126, 220, 0.2);
        }
        .pastel-theme #numbers-container {
            background-color: #fef0f8;
            border: 1px solid #b57edc;
        }
        .pastel-theme .number-box {
            background-color: #f0e1ff;
            color: #5e548e;
            border: 1px solid #b57edc;
        }
        .pastel-theme .number-box:hover {
            background-color: #c7b3e6;
            color: #fff;
        }
        .pastel-theme .number-box.selected {
            background-color: #ff66a4;
            color: #fff;
            transform: scale(1.05);
            box-shadow: 0 0 5px #ff66a4;
        }
        .pastel-theme .number-box.assigned {
            background-color: #e0e0e0;
            color: #a0a0a0;
        }
        .pastel-theme button {
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .pastel-theme #add-button { background-color: #b57edc; }
        .pastel-theme #add-button:hover { background-color: #a06ac9; }
        .pastel-theme #sorteo-button { background-color: #4a91f2; }
        .pastel-theme #sorteo-button:hover { background-color: #3b7ad6; }
        .pastel-theme #clear-button { background-color: #ff8c42; }
        .pastel-theme #clear-button:hover { background-color: #e67d35; }
        .pastel-theme .add-numbers-group button, .pastel-theme .range-buttons button { background-color: #72b9e6; }
        .pastel-theme .add-numbers-group button:hover, .pastel-theme .range-buttons button:hover { background-color: #61a9d4; }
        .pastel-theme #results-container, .pastel-theme #history-container {
            background-color: #fff8f8;
            border: 1px solid #b57edc;
        }
        .pastel-theme .person-entry, .pastel-theme .history-entry {
            border-bottom: 1px solid #e0c8ee;
        }
        .pastel-theme .person-name {
            color: #4a91f2;
        }
        .pastel-theme .action-button {
            color: #9381ff;
        }
        .pastel-theme .action-button:hover {
            color: #ff66a4;
        }
        .pastel-theme .edit-mode input[type="text"] {
            background-color: #fff0f3;
            color: #5e548e;
            border-color: #b57edc;
        }
        .pastel-theme .edit-mode .person-number-chip {
            background-color: #e0c8ee;
            color: #5e548e;
        }
        .pastel-theme .edit-mode .person-number-chip button {
            color: #ff66a4;
        }
        .pastel-theme .edit-mode #add-number-btn { background-color: #b57edc; color: #fff; }
        .pastel-theme .edit-mode #add-number-btn:hover { background-color: #a06ac9; }
        .pastel-theme .edit-mode #update-name-btn { background-color: #ff66a4; color: #fff; }
        .pastel-theme .edit-mode #update-name-btn:hover { background-color: #e65c92; }
        .pastel-theme #ganador-container h2 {
            color: #ff66a4;
        }
        .pastel-theme #ganador-nombre {
            color: #b57edc;
        }
        .pastel-theme #ganador-numero {
            color: #4a91f2;
        }
        .pastel-theme #countdown-timer {
            color: #ff8c42;
        }
        .pastel-theme #theme-selector {
            background-color: #fff0f3;
            color: #5e548e;
            border-color: #b57edc;
        }
        #theme-toggle-group {
            margin-top: 0;
            justify-content: flex-end;
        }
        #theme-selector {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background-color: #fff;
            color: #333;
        }
        .cosmic-theme #theme-selector {
            background-color: #220044;
            color: #a0d4ff;
            border-color: #4b0082;
        }
        .neon-theme #theme-selector {
            background-color: #333344;
            color: #64ffda;
            border-color: #64ffda;
        }
        .pastel-theme #theme-selector {
            background-color: #fff8f8;
            color: #5e548e;
            border-color: #b57edc;
        }
        .hide-on-edit-mode {
            display: none;
        }
        /* ESTILOS PARA LOS BOTONES DE GUARDAR/CARGAR */
        #save-data-button { background-color: #6c757d; }
        #save-data-button:hover { background-color: #5a6268; }
        #load-data-button { background-color: #17a2b8; }
        #load-data-button:hover { background-color: #138496; }
        .cosmic-theme #save-data-button { background-color: #663399; }
        .cosmic-theme #save-data-button:hover { background-color: #5a2c8a; }
        .cosmic-theme #load-data-button { background-color: #00aaff; }
        .cosmic-theme #load-data-button:hover { background-color: #0077cc; }
        .neon-theme #save-data-button { background-color: #ff00ff; color: #000; }
        .neon-theme #save-data-button:hover { background-color: #cc00cc; }
        .neon-theme #load-data-button { background-color: #00ffff; color: #000; }
        .neon-theme #load-data-button:hover { background-color: #00cccc; }
        .pastel-theme #save-data-button { background-color: #b57edc; }
        .pastel-theme #save-data-button:hover { background-color: #a06ac9; }
        .pastel-theme #load-data-button { background-color: #72b9e6; }
        .pastel-theme #load-data-button:hover { background-color: #61a9d4; }
        
        #save-code-container {
            margin-top: 15px;
            padding: 10px;
            background-color: #eee;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: none;
            word-break: break-all;
            text-align: center;
        }
        #save-code-container h4 {
            margin: 0;
            font-size: 1em;
            color: #555;
        }
        #saved-code {
            font-size: 1.5em;
            font-weight: bold;
            color: #007BFF;
            font-family: 'Courier New', monospace;
        }
        
        .cosmic-theme #save-code-container {
            background-color: #220044;
            border-color: #4b0082;
        }
        .cosmic-theme #save-code-container h4 {
            color: #b3a0d3;
        }
        .cosmic-theme #saved-code {
            color: #a0d4ff;
        }
        
        .neon-theme #save-code-container {
            background-color: #1a1a2a;
            border-color: #64ffda;
        }
        .neon-theme #save-code-container h4 {
            color: #f0f0f0;
        }
        .neon-theme #saved-code {
            color: #ff00ff;
        }
        
        .pastel-theme #save-code-container {
            background-color: #fff8f8;
            border-color: #b57edc;
        }
        .pastel-theme #save-code-container h4 {
            color: #5e548e;
        }
        .pastel-theme #saved-code {
            color: #b57edc;
        }
        /* --- NUEVO ESTILO PARA EL BORDE DE RESALTE --- */
        .number-box.resaltado {
            border: 3px solid #ff5722; /* Color naranja, puedes cambiarlo */
            transform: scale(1.1);
        }
        /* Fin de los nuevos estilos */
        .footer {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9em;
            color: #888;
        }
    </style>
</head>
<body>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

<div class="container" id="main-container">
    <div id="theme-toggle-group">
        <label for="theme-selector" style="font-weight: normal;">Seleccionar tema:</label>
        <select id="theme-selector">
            <option value="pastel" selected>Pastel Dreams</option>
            <option value="default">Cl√°sico</option>
        </select>
    </div>
    <div class="logo-container">
        <img src="logo.png" alt="Logo de Red Pilar" class="logo">
    </div>
    <h1>Red Pilar</h1>

    <div class="form-group">
        <label for="search-number">Buscar y resaltar n√∫mero:</label>
        <input type="text" id="search-number" placeholder="Ej: 02, 102...">
    </div>

    <div class="form-group">
        <label for="person-name">Nombre de la persona:</label>
        <input type="text" id="person-name" placeholder="Escribe el nombre aqu√≠...">
    </div>

    <label id="numbers-range-label">Selecciona los n√∫meros (00 a 99):</label>
    <div id="numbers-container"></div>

    <label>Modificar cantidad de n√∫meros:</label>
    <div class="add-numbers-group">
        <button id="add-10-button">+10</button>
        <button id="remove-10-button">-10</button>
    </div>
    <label>Selecci√≥n de rango:</label>
    <div class="range-buttons">
        <button id="select-range-10-button">Seleccionar +10</button>
    </div>

    <div class="button-group">
        <button id="add-button">Agregar persona y n√∫meros</button>
        <button id="sorteo-button">Sortear</button>
    </div>

    <div style="display: flex; justify-content: flex-end; margin-top: 10px;">
        <button id="clear-button" style="width: 48%;">Limpiar todo</button>
    </div>

    <hr>
    
    <div style="text-align: center; margin-top: 20px;">
        <button id="save-data-button" style="padding: 10px 20px; border: none; border-radius: 4px; color: #fff; cursor: pointer;">Guardar Sorteo</button>
        <input type="text" id="load-code-input" placeholder="Ingresa tu c√≥digo" style="padding: 10px; border-radius: 4px; border: 1px solid #ccc; width: 150px;">
        <button id="load-data-button" style="padding: 10px 20px; border: none; border-radius: 4px; color: #fff; cursor: pointer;">Cargar Sorteo</button>
    </div>
    
    <div id="save-code-container">
        <h4>Tu sorteo ha sido guardado.</h4>
        <p>¬°Guarda este c√≥digo para cargarlo en otro momento! üëâ <span id="saved-code"></span></p>
    </div>

    <hr>

    <div id="results-container">
        <h2>Participantes</h2>
        <div class="form-group">
            <input type="text" id="search-person" placeholder="Busca por nombre o n√∫mero...">
        </div>
        <div id="results-list">
        </div>
    </div>

    <div id="ganador-container" style="display:none;">
        <div id="countdown-timer"></div>
        <h2>¬°El n√∫mero ganador es!</h2>
        <div id="ganador-numero"></div>
        <h2>¬°Y el ganador es!</h2>
        <div id="ganador-nombre"></div>
    </div>
    <div class="footer">
        design by Clau
    </div>

</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyCQdtjwagG3pH2_MZAV2pKVq9HS7I-ufHk",
      authDomain: "sorteo-24534.firebaseapp.com",
      projectId: "sorteo-24534",
      storageBucket: "sorteo-24534.firebasestorage.app",
      messagingSenderId: "546018107328",
      appId: "1:546018107328:web:4eb823a41e3cd70c29f225"
    };

    // Inicializa Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const numbersContainer = document.getElementById('numbers-container');
    const personNameInput = document.getElementById('person-name');
    const addButton = document.getElementById('add-button');
    const clearButton = document.getElementById('clear-button');
    const sorteoButton = document.getElementById('sorteo-button');
    const add10Button = document.getElementById('add-10-button');
    const remove10Button = document.getElementById('remove-10-button');
    const selectRange10Button = document.getElementById('select-range-10-button');
    const resultsList = document.getElementById('results-list');
    const ganadorContainer = document.getElementById('ganador-container');
    const ganadorNumero = document.getElementById('ganador-numero');
    const ganadorNombre = document.getElementById('ganador-nombre');
    const countdownTimer = document.getElementById('countdown-timer');
    const themeSelector = document.getElementById('theme-selector');
    const body = document.body;
    const mainContainer = document.getElementById('main-container');
    const numbersRangeLabel = document.getElementById('numbers-range-label');

    const saveButton = document.getElementById('save-data-button');
    const loadButton = document.getElementById('load-data-button');
    const loadCodeInput = document.getElementById('load-code-input');
    const saveCodeContainer = document.getElementById('save-code-container');
    const savedCodeElement = document.getElementById('saved-code');
    
    // Campo de b√∫squeda de n√∫meros
    const searchNumberInput = document.getElementById('search-number');
    // Nuevo campo de b√∫squeda de participantes
    const searchPersonInput = document.getElementById('search-person');


    const countdownSound = new Audio('https://www.soundboard.com/mediafiles/3/30018_e2f694931a78c1874249a567634f195d.mp3');
    const spinSound = new Audio('https://www.soundboard.com/mediafiles/1/18167_nfs_prostreet_rev_4.mp3');
    const winnerSound = new Audio('https://www.soundboard.com/mediafiles/6/6389_87900b90e9e46a78280f58a329d91f86.mp3');

    let selectedNumbers = [];
    let allParticipants = [];
    let assignedNumbers = new Set();
    const MIN_NUMBERS = 100;
    let currentMaxNumber = 99;
    let currentRaffleCode = null; // Variable para almacenar el c√≥digo del sorteo cargado

    loadData();

    function updateRangeLabel() {
        numbersRangeLabel.textContent = `Selecciona los n√∫meros (00 a ${currentMaxNumber}):`;
    }

    function createNumberBox(number) {
        const numberBox = document.createElement('div');
        numberBox.classList.add('number-box');
        numberBox.textContent = String(number).padStart(2, '0');
        numberBox.dataset.number = number;
        numbersContainer.appendChild(numberBox);

        numberBox.addEventListener('click', () => {
            if (!numberBox.classList.contains('assigned')) {
                numberBox.classList.toggle('selected');
                const num = parseInt(numberBox.dataset.number);
                const index = selectedNumbers.indexOf(num);
                if (index > -1) {
                    selectedNumbers.splice(index, 1);
                } else {
                    selectedNumbers.push(num);
                }
            }
        });
    }

    function generateNumberBoxes(start, end) {
        for (let i = start; i <= end; i++) {
            createNumberBox(i);
        }
    }

    function saveData() {
        const data = {
            participants: allParticipants,
            assignedNumbers: [...assignedNumbers],
            currentMaxNumber: currentMaxNumber
        };
        const docRef = db.collection("sorteos").doc();
        docRef.set(data)
            .then(() => {
                savedCodeElement.textContent = docRef.id;
                saveCodeContainer.style.display = 'block';
                currentRaffleCode = docRef.id;
                console.log("Documento guardado con ID: ", docRef.id);
            })
            .catch((error) => {
                console.error("Error al guardar el documento: ", error);
                alert("Error al guardar el sorteo. Intenta de nuevo.");
            });
    }

    function loadData() {
        if (!currentRaffleCode) {
            console.log("No hay c√≥digo de sorteo cargado. Generando n√∫meros predeterminados.");
            generateNumberBoxes(0, currentMaxNumber);
            return;
        }

        const docRef = db.collection("sorteos").doc(currentRaffleCode);
        docRef.get().then((doc) => {
            if (doc.exists) {
                const data = doc.data();
                allParticipants = data.participants || [];
                assignedNumbers = new Set(data.assignedNumbers || []);
                currentMaxNumber = data.currentMaxNumber || 99;

                numbersContainer.innerHTML = '';
                generateNumberBoxes(0, currentMaxNumber);
                updateRangeLabel();
                updateAllNumberBoxes();
                renderParticipants(allParticipants);
                console.log("Sorteo cargado exitosamente.");
            } else {
                console.log("No se encontr√≥ el sorteo con el c√≥digo proporcionado.");
                alert("No se encontr√≥ el sorteo con ese c√≥digo. Generando uno nuevo.");
                clearAllData();
            }
        }).catch((error) => {
            console.error("Error al cargar el documento: ", error);
            alert("Error al cargar el sorteo. Intenta de nuevo.");
        });
    }

    function addPerson() {
        const personName = personNameInput.value.trim();
        if (personName && selectedNumbers.length > 0) {
            const newParticipant = {
                id: Date.now(),
                name: personName,
                numbers: selectedNumbers.sort((a, b) => a - b)
            };
            allParticipants.push(newParticipant);
            selectedNumbers.forEach(num => assignedNumbers.add(num));
            renderParticipants(allParticipants);
            updateNumberBoxes();
            clearInputs();
        } else {
            alert('Por favor, ingresa un nombre y selecciona al menos un n√∫mero.');
        }
    }

    function clearInputs() {
        personNameInput.value = '';
        selectedNumbers = [];
        const selectedBoxes = document.querySelectorAll('.number-box.selected');
        selectedBoxes.forEach(box => box.classList.remove('selected'));
    }

    function updateNumberBoxes() {
        const allBoxes = document.querySelectorAll('.number-box');
        allBoxes.forEach(box => {
            const num = parseInt(box.dataset.number);
            if (assignedNumbers.has(num)) {
                box.classList.add('assigned');
                box.classList.remove('selected');
            } else {
                box.classList.remove('assigned');
            }
        });
    }

    function updateAllNumberBoxes() {
        numbersContainer.innerHTML = '';
        generateNumberBoxes(0, currentMaxNumber);
        updateNumberBoxes();
    }

    function renderParticipants(participants) {
        resultsList.innerHTML = '';
        participants.forEach(person => {
            const personEntry = document.createElement('div');
            personEntry.classList.add('person-entry');
            personEntry.dataset.id = person.id;
            personEntry.innerHTML = `
                <div class="person-info">
                    <div class="person-name">${person.name}</div>
                    <div class="person-numbers">${person.numbers.map(num => String(num).padStart(2, '0')).join(', ')}</div>
                </div>
                <div class="person-actions">
                    <button class="action-button edit-button" onclick="editPerson(${person.id})">‚úèÔ∏è</button>
                    <button class="action-button delete-button" onclick="deletePerson(${person.id})">üóëÔ∏è</button>
                </div>
            `;
            resultsList.appendChild(personEntry);
        });
    }

    function deletePerson(id) {
        const personIndex = allParticipants.findIndex(p => p.id === id);
        if (personIndex !== -1) {
            const person = allParticipants[personIndex];
            person.numbers.forEach(num => assignedNumbers.delete(num));
            allParticipants.splice(personIndex, 1);
            renderParticipants(allParticipants);
            updateNumberBoxes();
        }
    }

    function editPerson(id) {
        const personEntry = document.querySelector(`.person-entry[data-id='${id}']`);
        personEntry.classList.add('edit-mode');
        const person = allParticipants.find(p => p.id === id);
        personEntry.innerHTML = `
            <div class="person-info">
                <input type="text" id="edit-name-${id}" value="${person.name}" class="person-name-input">
                <div class="person-numbers-list" id="numbers-list-${id}">
                    ${person.numbers.map(num => `
                        <span class="person-number-chip">
                            ${String(num).padStart(2, '0')}
                            <button onclick="removeNumberFromPerson(${id}, ${num})">x</button>
                        </span>
                    `).join('')}
                </div>
                <div style="display: flex; align-items: center; margin-top: 10px;">
                    <input type="text" id="add-number-input-${id}" placeholder="Agregar n√∫mero" style="width: 100px; margin-right: 5px;">
                    <button id="add-number-btn" onclick="addNumberToPerson(${id})">‚ûï</button>
                </div>
            </div>
            <div class="person-actions">
                <button id="update-name-btn" onclick="updatePerson(${id})">Guardar</button>
                <button class="action-button" onclick="cancelEdit(${id})">‚ùå</button>
            </div>
        `;
    }

    function updatePerson(id) {
        const nameInput = document.getElementById(`edit-name-${id}`);
        const newName = nameInput.value.trim();
        const person = allParticipants.find(p => p.id === id);
        if (person) {
            person.name = newName;
            renderParticipants(allParticipants);
        }
    }

    function addNumberToPerson(id) {
        const numberInput = document.getElementById(`add-number-input-${id}`);
        const numberToAdd = parseInt(numberInput.value.trim());

        if (!isNaN(numberToAdd) && numberToAdd >= 0 && numberToAdd <= currentMaxNumber) {
            const numberString = String(numberToAdd).padStart(2, '0');
            const person = allParticipants.find(p => p.id === id);

            if (person && !person.numbers.includes(numberToAdd) && !assignedNumbers.has(numberToAdd)) {
                person.numbers.push(numberToAdd);
                person.numbers.sort((a, b) => a - b);
                assignedNumbers.add(numberToAdd);
                renderParticipants(allParticipants);
                updateNumberBoxes();
            } else if (assignedNumbers.has(numberToAdd)) {
                alert(`El n√∫mero ${numberString} ya est√° asignado.`);
            }
        }
        numberInput.value = '';
    }

    function removeNumberFromPerson(personId, numberToRemove) {
        const person = allParticipants.find(p => p.id === personId);
        if (person) {
            const index = person.numbers.indexOf(numberToRemove);
            if (index > -1) {
                person.numbers.splice(index, 1);
                assignedNumbers.delete(numberToRemove);
                renderParticipants(allParticipants);
                updateNumberBoxes();
                editPerson(personId);
            }
        }
    }

    function cancelEdit(id) {
        renderParticipants(allParticipants);
    }
    
    function startSorteo() {
        ganadorContainer.style.display = 'block';
        ganadorNombre.textContent = '';
        ganadorNumero.textContent = '';
        let availableNumbers = [];
        allParticipants.forEach(p => {
            availableNumbers.push(...p.numbers.filter(num => !p.alreadyWon));
        });
        
        if (availableNumbers.length === 0) {
            alert("No hay n√∫meros disponibles para sortear. ¬°Todos los participantes han ganado!");
            ganadorContainer.style.display = 'none';
            return;
        }

        const uniqueNumbers = [...new Set(availableNumbers)];
        let count = 0;
        let countdown = 5;

        // Limpiar animaciones previas
        ganadorNombre.classList.remove('ganador-zoom');
        ganadorNumero.classList.remove('ganador-zoom');

        sorteoButton.disabled = true;
        
        countdownTimer.textContent = countdown;
        countdownTimer.style.display = 'block';
        countdownSound.currentTime = 0;
        countdownSound.play();

        const countdownInterval = setInterval(() => {
            countdown--;
            if (countdown > 0) {
                countdownTimer.textContent = countdown;
            } else {
                clearInterval(countdownInterval);
                countdownTimer.style.display = 'none';
                spinSound.currentTime = 0;
                spinSound.play();
                startSpinningAnimation(uniqueNumbers);
            }
        }, 1000);
    }

    function startSpinningAnimation(numbers) {
        let spinning = true;
        let spinInterval = setInterval(() => {
            const randomIndex = Math.floor(Math.random() * numbers.length);
            const randomNum = numbers[randomIndex];
            ganadorNumero.textContent = String(randomNum).padStart(2, '0');
            ganadorNumero.classList.add('sorteo-running');
            ganadorNombre.textContent = '...';
        }, 50);

        setTimeout(() => {
            clearInterval(spinInterval);
            spinSound.pause();
            spinSound.currentTime = 0;
            ganadorNumero.classList.remove('sorteo-running');
            determineWinner(numbers);
        }, 3000);
    }

    function determineWinner(availableNumbers) {
        const winningNumber = availableNumbers[Math.floor(Math.random() * availableNumbers.length)];
        const winner = allParticipants.find(p => p.numbers.includes(winningNumber));
        
        ganadorNumero.textContent = String(winningNumber).padStart(2, '0');
        ganadorNombre.textContent = winner ? winner.name : "Nadie";

        ganadorNombre.classList.add('ganador-zoom');
        ganadorNumero.classList.add('ganador-zoom');

        if (winner) {
            winnerSound.currentTime = 0;
            winnerSound.play();
            winner.alreadyWon = true; // Marca al participante como ganador
            
            // Crea y lanza confeti
            for (let i = 0; i < 50; i++) {
                createConfetti();
            }
        }
        
        sorteoButton.disabled = false;
        
        // Agregar el resultado al historial
        addHistory(winner ? winner.name : "Nadie", winningNumber);

        // Ocultar el ganador despu√©s de 10 segundos
        setTimeout(() => {
            ganadorContainer.style.display = 'none';
        }, 10000);
    }
    
    function createConfetti() {
        const confetti = document.createElement('div');
        confetti.classList.add('confetti');
        confetti.style.left = `${Math.random() * 100}%`;
        confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
        confetti.style.animationDuration = `${Math.random() * 2 + 3}s`;
        document.body.appendChild(confetti);

        confetti.addEventListener('animationend', () => {
            confetti.remove();
        });
    }

    function clearAllData() {
        allParticipants = [];
        selectedNumbers = [];
        assignedNumbers.clear();
        currentMaxNumber = 99;
        currentRaffleCode = null;
        numbersContainer.innerHTML = '';
        resultsList.innerHTML = '';
        ganadorContainer.style.display = 'none';
        generateNumberBoxes(0, currentMaxNumber);
        updateRangeLabel();
        saveCodeContainer.style.display = 'none';
        document.getElementById('history-container').innerHTML = '<h2>Historial de Sorteos</h2>';
        alert('Todos los datos han sido limpiados y se ha iniciado un nuevo sorteo.');
    }

    function addHistory(winnerName, winnerNumber) {
        const historyContainer = document.getElementById('history-container');
        if (!historyContainer) {
            console.error("No se encontr√≥ el contenedor de historial.");
            return;
        }

        const historyEntry = document.createElement('div');
        historyEntry.classList.add('history-entry');
        historyEntry.innerHTML = `
            <span>Ganador: <strong>${winnerName}</strong></span>
            <span>N√∫mero: <strong>${String(winnerNumber).padStart(2, '0')}</strong></span>
        `;
        historyContainer.appendChild(historyEntry);
    }
    
    function modifyNumberRange(amount) {
        const newMax = currentMaxNumber + amount;
        if (newMax < MIN_NUMBERS - 1) {
            alert(`No puedes tener menos de ${MIN_NUMBERS} n√∫meros.`);
            return;
        }
        currentMaxNumber = newMax;
        updateAllNumberBoxes();
        updateRangeLabel();
    }
    
    function selectRange(amount) {
        let startNumber = selectedNumbers.length > 0 ? selectedNumbers[selectedNumbers.length - 1] + 1 : 0;
        let numbersToAdd = [];
        for (let i = 0; i < amount; i++) {
            const num = startNumber + i;
            if (num <= currentMaxNumber && !assignedNumbers.has(num)) {
                numbersToAdd.push(num);
            } else if (num > currentMaxNumber) {
                alert(`No hay suficientes n√∫meros disponibles para seleccionar ${amount}.`);
                break;
            }
        }
        
        if (numbersToAdd.length > 0) {
            numbersToAdd.forEach(num => {
                const box = document.querySelector(`.number-box[data-number="${num}"]`);
                if (box) {
                    box.classList.add('selected');
                    if (!selectedNumbers.includes(num)) {
                        selectedNumbers.push(num);
                    }
                }
            });
            selectedNumbers.sort((a, b) => a - b);
        }
    }

    function applyTheme(theme) {
        body.className = '';
        mainContainer.className = 'container';
        if (theme !== 'default') {
            body.classList.add(`${theme}-theme`);
            mainContainer.classList.add(`${theme}-theme`);
        }
        localStorage.setItem('raffleTheme', theme);
    }

    // Event Listeners
    addButton.addEventListener('click', addPerson);
    sorteoButton.addEventListener('click', startSorteo);
    clearButton.addEventListener('click', clearAllData);
    add10Button.addEventListener('click', () => modifyNumberRange(10));
    remove10Button.addEventListener('click', () => modifyNumberRange(-10));
    selectRange10Button.addEventListener('click', () => selectRange(10));
    themeSelector.addEventListener('change', (event) => {
        applyTheme(event.target.value);
    });

    // Cargar el tema guardado
    const savedTheme = localStorage.getItem('raffleTheme');
    if (savedTheme) {
        applyTheme(savedTheme);
        themeSelector.value = savedTheme;
    }
    
    // Funcionalidad de b√∫squeda de n√∫meros
    searchNumberInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.padStart(2, '0');
        const numberBoxes = document.querySelectorAll('.number-box');
        
        numberBoxes.forEach(box => {
            box.classList.remove('resaltado');
        });
        
        if (searchTerm.length >= 2) {
            const foundBox = document.querySelector(`.number-box[data-number="${parseInt(searchTerm)}"]`);
            if (foundBox) {
                foundBox.classList.add('resaltado');
                foundBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    });

    // Funcionalidad de b√∫squeda de participantes
    searchPersonInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        const filteredParticipants = allParticipants.filter(p => 
            p.name.toLowerCase().includes(searchTerm) || 
            p.numbers.some(num => String(num).padStart(2, '0').includes(searchTerm))
        );
        renderParticipants(filteredParticipants);
    });

    // Eventos para guardar y cargar
    saveButton.addEventListener('click', saveData);
    loadButton.addEventListener('click', () => {
        const code = loadCodeInput.value.trim();
        if (code) {
            currentRaffleCode = code;
            loadData();
        } else {
            alert('Por favor, ingresa un c√≥digo de sorteo.');
        }
    });

</script>

</body>
</html>
